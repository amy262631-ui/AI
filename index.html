<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å‰µæ–°æ¢éšªæ—¥èªŒ - æˆæœå±•ç¤ºæ——è‰¦ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');                
        :root {
            --game-pink: #ff4d91;
            --game-purple: #7000ff;
            --game-cyan: #00f2ff;
            --game-yellow: #ffee00;
        }
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: #f0f2f9;
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 40px 40px;
            color: #2d3748;
            overflow-x: hidden;
        }
        .adventure-card { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(12px); 
            border-radius: 2rem; 
            box-shadow: 0 15px 35px -5px rgba(112, 0, 255, 0.1);
            border: 3px solid #ffffff;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-game { transition: all 0.2s; box-shadow: 0 4px 0px #4a00aa; }
        .btn-game:active { transform: translateY(4px); box-shadow: 0 0px 0px #4a00aa; }
        .star-rating-active { color: var(--game-yellow); text-shadow: 0 0 10px rgba(255, 238, 0, 0.5); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .pulse-soft { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .loading-overlay { background: rgba(240, 242, 249, 0.9); display: none; }
        .summary-table th { font-size: 1rem; background: var(--game-purple); color: white; padding: 1.2rem; border: none; white-space: nowrap; }
        .summary-table td { font-size: 1.2rem; padding: 1.5rem 1rem; border-bottom: 2px solid #edf2f7; }
        .achievement-score { 
            font-size: 2.5rem; 
            background: linear-gradient(to right, var(--game-pink), var(--game-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }
        .hero-title-font { font-size: 1.75rem; font-weight: 900; }
        input { border: 2px solid #e2e8f0 !important; border-radius: 1.2rem !important; }
    </style>
</head>
<body class="min-h-screen py-6 md:py-10 px-4 md:px-6">

    <div id="loading" class="fixed inset-0 z-[100] flex items-center justify-center loading-overlay backdrop-blur-sm">
        <div class="text-center p-6 bg-white rounded-3xl shadow-2xl">
            <div class="p-6 bg-white rounded-full pulse-soft inline-block">
                <i class="fas fa-gamepad text-6xl text-purple-600"></i>
            </div>
            <p class="text-purple-600 font-black text-2xl mt-4 tracking-widest uppercase">è³‡æ–™åŒæ­¥ä¸­...</p>
        </div>
    </div>

    <div class="max-w-[1500px] mx-auto">
        <header class="text-center mb-10 md:mb-16">
            <h1 class="text-4xl md:text-7xl font-black text-slate-900 mb-6 italic uppercase tracking-tighter">AI <span class="text-purple-600">Innovation</span> Quest</h1>
            <p class="text-slate-500 text-lg md:text-2xl font-bold">é”æˆä»»å‹™å¾Œã€Œé€¾æœŸæç¤ºã€å°‡è‡ªå‹•éš±è—ï¼Œè®“ç‰ˆé¢æ›´æ¸…çˆ½ âœ¨</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 md:gap-12">
            <aside class="lg:col-span-3 order-2 lg:order-1">
                <div class="adventure-card p-6 md:p-10 sticky top-8 border-b-[10px] border-b-purple-100 shadow-2xl">
                    <h2 class="text-2xl md:text-3xl font-black mb-8 text-purple-600 flex items-center italic">
                        <i class="fas fa-plus-square mr-4 text-pink-500"></i> ç™¼èµ·ä»»å‹™
                    </h2>
                    <form id="aiForm" class="space-y-6 md:space-y-8">
                        <div>
                            <label class="block text-xs font-black text-slate-400 uppercase mb-3 ml-1 tracking-widest">å†’éšªè€…ç¨±è™Ÿ</label>
                            <input type="text" id="name" required placeholder="æ‚¨çš„å§“å" class="w-full px-5 py-4 bg-white font-bold text-lg shadow-inner">
                        </div>
                        <div>
                            <label class="block text-xs font-black text-slate-400 uppercase mb-3 ml-1 tracking-widest">ä»»å‹™ä¸»é¡Œ</label>
                            <input type="text" id="topic" required placeholder="æƒ³é€²åŒ–çš„é»å­" class="w-full px-5 py-4 bg-white font-bold text-lg shadow-inner">
                        </div>
                        <div class="grid grid-cols-1 gap-4 md:gap-6">
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase mb-3 ml-1">èµ·å§‹æ—¥</label>
                                <input type="date" id="startDate" required class="w-full px-4 py-3 bg-white font-bold text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase mb-3 ml-1">é è¨ˆæŠµé”</label>
                                <input type="date" id="deadline" required class="w-full px-4 py-3 bg-white font-bold text-sm">
                            </div>
                        </div>
                        <button type="submit" class="btn-game w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-black py-5 rounded-2xl md:rounded-3xl shadow-lg text-xl md:text-2xl uppercase tracking-[0.1em]">
                            å•Ÿå‹•å†’éšª ğŸš€
                        </button>
                    </form>
                    <div class="mt-8 pt-8 border-t border-slate-100">
                        <button onclick="toggleAdminView()" id="adminBtn" class="w-full py-4 bg-slate-50 text-slate-400 border-2 border-slate-100 rounded-2xl font-black text-sm hover:bg-slate-900 hover:text-white transition-all">
                            <i class="fas fa-user-shield mr-2"></i> ç®¡ç†å“¡æ¨¡å¼
                        </button>
                    </div>
                </div>
            </aside>

            <main class="lg:col-span-9 space-y-16 md:space-y-24 order-1 lg:order-2">
                <div>
                    <div class="flex flex-col sm:flex-row justify-between items-center sm:items-end mb-8 md:mb-12 px-2 md:px-6 gap-4">
                        <h2 class="text-3xl md:text-5xl font-black text-slate-900 tracking-tighter italic flex items-center">
                            <i class="fas fa-layer-group mr-4 md:mr-6 text-purple-500"></i> ç•¶å‰ä»»å‹™ç‹€æ…‹
                        </h2>
                        <div class="text-xl font-black text-white bg-slate-900 px-8 py-3 rounded-full shadow-xl">
                            å†’éšªç¸½æ•¸: <span id="projectCount" class="text-cyan-400 ml-2">0</span>
                        </div>
                    </div>
                    <div id="projectList" class="space-y-6 md:space-y-8"></div>
                </div>

                <div class="pt-12 border-t-4 border-slate-200">
                    <h2 class="text-3xl md:text-5xl font-black text-slate-900 mb-12 italic flex items-center">
                        <i class="fas fa-crown mr-4 text-yellow-400"></i> å¤¥ä¼´æ¢éšªæˆ°åŠ›æ¦œ
                    </h2>
                    <div class="adventure-card shadow-2xl overflow-hidden bg-white">
                        <div class="overflow-x-auto no-scrollbar">
                            <table class="w-full text-left summary-table">
                                <thead class="tracking-widest">
                                    <tr>
                                        <th class="px-6 py-6 md:px-10">è‹±é›„å†’éšªè€…</th>
                                        <th class="px-4 text-center">æ¢éšªåŠ æˆ</th>
                                        <th class="px-4 text-center">å¥§æ´æ¬¡æ•¸</th>
                                        <th class="px-6 py-6 md:px-12 text-right">æˆ°åŠ›ç¸½å€¼</th>
                                    </tr>
                                </thead>
                                <tbody id="summaryTableBody" class="font-bold text-slate-800 bg-white italic"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="ratingModal" class="fixed inset-0 bg-purple-900/80 hidden flex items-center justify-center z-50 p-4 backdrop-blur-xl">
        <div class="bg-white rounded-[3rem] p-8 md:p-12 max-w-2xl w-full shadow-2xl border-8 border-white overflow-y-auto max-h-[90vh]">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4 pulse-soft">âœ¨</div>
                <h3 class="text-3xl md:text-5xl font-black text-slate-900 mb-2">å‚³é€å¥§æ´èƒ½é‡</h3>
                <p id="ratingProjectName" class="text-purple-600 font-black text-xl md:text-2xl italic"></p>
            </div>
            <div class="space-y-8">
                <input type="text" id="voterName" placeholder="æ‚¨çš„è‹±é›„ç¨±è™Ÿ" class="w-full bg-slate-50 border-4 border-slate-100 rounded-[1.5rem] px-8 py-4 font-black text-2xl text-center shadow-inner">
                <div class="space-y-6 bg-purple-50 p-8 rounded-[2rem] border-4 border-white">
                    <div class="rating-row" data-category="logic"><label class="flex justify-between font-black text-purple-400 uppercase">åº•å±¤é‚è¼¯ <span class="score-display text-purple-600 text-3xl">0</span></label><div class="flex justify-between text-5xl star-row"><i class="far fa-star cursor-pointer" data-val="1"></i><i class="far fa-star cursor-pointer" data-val="2"></i><i class="far fa-star cursor-pointer" data-val="3"></i><i class="far fa-star cursor-pointer" data-val="4"></i><i class="far fa-star cursor-pointer" data-val="5"></i></div></div>
                    <div class="rating-row" data-category="utility"><label class="flex justify-between font-black text-purple-400 uppercase">è¾¦å…¬å¯¦ç”¨ <span class="score-display text-emerald-500 text-3xl">0</span></label><div class="flex justify-between text-5xl star-row"><i class="far fa-star cursor-pointer" data-val="1"></i><i class="far fa-star cursor-pointer" data-val="2"></i><i class="far fa-star cursor-pointer" data-val="3"></i><i class="far fa-star cursor-pointer" data-val="4"></i><i class="far fa-star cursor-pointer" data-val="5"></i></div></div>
                    <div class="rating-row" data-category="innovation"><label class="flex justify-between font-black text-purple-400 uppercase">æŠ€è¡“å‰µæ–° <span class="score-display text-orange-500 text-3xl">0</span></label><div class="flex justify-between text-5xl star-row"><i class="far fa-star cursor-pointer" data-val="1"></i><i class="far fa-star cursor-pointer" data-val="2"></i><i class="far fa-star cursor-pointer" data-val="3"></i><i class="far fa-star cursor-pointer" data-val="4"></i><i class="far fa-star cursor-pointer" data-val="5"></i></div></div>
                </div>
            </div>
            <div class="flex gap-4 mt-12">
                <button onclick="closeRatingModal()" class="flex-1 py-5 bg-slate-100 rounded-2xl font-black text-slate-400 text-xl">ç¨å¾Œ</button>
                <button onclick="submitMultiVote()" class="flex-[2] btn-game bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-2xl font-black text-xl">å‚³é€èƒ½é‡ âš¡</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 px-10 py-5 bg-slate-900 text-white rounded-full opacity-0 transition-all duration-500 z-[110] font-black tracking-widest text-lg">å‹•ä½œæˆåŠŸï¼</div>

    <script>
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbwW-rvZr0lOzoJFfQc_t6ML_Ogx80gKEMZ_6C57iflWFiov5KeSQUwIwHtMlu2AlAd9/exec';
        let currentRatingProjectId = null, selectedScores = { logic: 0, utility: 0, innovation: 0 }, isAdminView = false, globalData = [];

        window.onload = () => {
            document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('deadline').value = new Date(Date.now() + 14*86400000).toISOString().split('T')[0];
            fetchData(); setupStars();
        };

        function getRemainingDaysLabel(deadlineStr, status) {
            if (!deadlineStr || (status || "").includes('é”æˆ') || (status || "").includes('å®Œæˆ')) return "";
            const diffDays = Math.ceil((new Date(deadlineStr) - new Date().setHours(0,0,0,0)) / 86400000);
            if (diffDays < 0) return `<span class="bg-red-500 text-white px-3 py-1 rounded-full font-black text-[10px] shadow-sm border-2 border-white ml-2 whitespace-nowrap">é€¾æœŸ: ${Math.abs(diffDays)}å¤©</span>`;
            if (diffDays === 0) return `<span class="bg-yellow-400 text-purple-900 px-3 py-1 rounded-full font-black text-[10px] shadow-sm border-2 border-white pulse-soft ml-2">æœ€å¾Œä¸€å¤©!</span>`;
            return `<span class="bg-cyan-400 text-purple-900 px-3 py-1 rounded-full font-black text-[10px] shadow-sm border-2 border-white ml-2 whitespace-nowrap">å‰©é¤˜: ${diffDays}å¤©</span>`;
        }

        async function fetchData() {
            showLoading(true);
            try {
                const res = await fetch(`${GAS_URL}?t=${Date.now()}`, { cache: "no-store" });
                globalData = await res.json();
                updateUI();
            } catch (e) { showToast("é€£ç·šä¸­æ–·"); }
            showLoading(false);
        }

        async function cloudAction(params) {
            showLoading(true);
            try {
                await fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(params) });
                showToast("åŒæ­¥ä¸­..."); setTimeout(fetchData, 2500); 
            } catch (e) { showToast("å‚³è¼¸å¤±æ•—"); showLoading(false); }
        }

        function updateUI() {
            document.getElementById('projectCount').textContent = globalData.length;
            renderProjects(globalData); renderSummary(globalData);
        }

        function renderProjects(items) {
            const list = document.getElementById('projectList');
            if (items.length === 0) { list.innerHTML = '<div class="text-center py-20 text-slate-400 italic text-2xl bg-white/30 rounded-[2rem] border-4 border-dashed border-slate-200">è®€å–å†’éšªæ—¥èªŒä¸­...</div>'; return; }
            list.innerHTML = [...items].reverse().map(item => {
                const voters = Object.keys(item.votes || {}), vCount = voters.length;
                let sum = 0; voters.forEach(v => sum += (Number(item.votes[v].logic) + Number(item.votes[v].utility) + Number(item.votes[v].innovation)));
                const avg = vCount > 0 ? (sum / (vCount * 3)).toFixed(1) : '0.0';
                const isCompleted = (item.status || "").includes('é”æˆ') || (item.status || "").includes('å®Œæˆ');

                return `
                <div class="adventure-card p-6 md:p-10 border-2 border-white group">
                    <div class="flex flex-col xl:flex-row justify-between items-start gap-8">
                        <div class="flex-1 space-y-6 w-full">
                            <div class="flex flex-wrap items-center gap-2">
                                <span class="px-3 py-1 bg-purple-600 text-white rounded-full text-[10px] font-black uppercase tracking-widest">MISSION #${item.id.toString().slice(-4)}</span>
                                <div class="text-xs md:text-lg text-slate-500 font-black bg-white/80 px-4 py-1.5 rounded-full border border-slate-100 shadow-sm flex items-center whitespace-nowrap">
                                    <i class="far fa-clock mr-2 text-purple-500"></i>${formatDate(item.startdate)} â” ${formatDate(item.deadline)}
                                    ${getRemainingDaysLabel(item.deadline, item.status)}
                                </div>
                            </div>
                            <h3 class="text-2xl md:text-4xl font-black text-slate-800 italic uppercase break-words leading-tight tracking-tighter">${item.topic}</h3>
                            <div class="flex flex-wrap items-center gap-6">
                                <span class="hero-title-font text-purple-600 italic flex items-center bg-white px-5 py-2 rounded-2xl shadow-sm border-2 border-purple-50 whitespace-nowrap">
                                    <i class="fas fa-user-ninja mr-3"></i>@${item.name}
                                </span>
                                <div class="bg-slate-900 text-white px-6 py-2 rounded-[2rem] border-4 border-slate-800 shadow-xl whitespace-nowrap">
                                    <div class="flex items-center hero-title-font tracking-tighter text-cyan-400"><i class="fas fa-star mr-2 text-yellow-400"></i>EXP: ${avg}</div>
                                </div>
                                ${item.link ? `<a href="${item.link}" target="_blank" class="px-5 py-2 bg-white border-2 border-purple-600 text-purple-600 font-black rounded-xl hover:bg-purple-600 hover:text-white transition shadow-md whitespace-nowrap">æœè–æˆæœ <i class="fas fa-external-link-alt ml-2"></i></a>` : ''}
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row items-center gap-4 w-full xl:w-auto">
                            <span class="px-8 py-4 rounded-2xl text-lg font-black border-b-4 shadow-lg ${getStatusClass(item.status)} whitespace-nowrap">${item.status || 'ğŸš€ æ­£åœ¨èµ·é£›'}</span>
                            <div class="flex gap-2">
                                <button onclick="toggleStatus('${item.id}')" class="p-5 bg-white text-slate-400 rounded-2xl border-2 border-slate-100 btn-game"><i class="fas fa-sync-alt text-2xl"></i></button>
                                <button onclick="updateProjectLink('${item.id}')" class="p-5 bg-white text-purple-600 rounded-2xl border-2 border-slate-100 btn-game"><i class="fas fa-link text-2xl"></i></button>
                                ${isCompleted ? `<button onclick="openRatingModal('${item.id}', '${item.topic}')" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-8 py-4 rounded-2xl font-black text-xl btn-game pulse-soft">å¥§æ´ âš¡</button>` : ''}
                                <button onclick="deleteProject('${item.id}')" class="p-5 bg-white text-slate-200 hover:text-red-500 rounded-2xl border-2 border-slate-100 btn-game"><i class="far fa-trash-alt text-2xl"></i></button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderSummary(items) {
            const stats = {};
            items.forEach(item => {
                const n = item.name || "å‹‡è€…"; if (!stats[n]) stats[n] = { total: 0, logic: 0, utility: 0, innovation: 0, vCount: 0 };
                if ((item.status || "").includes('é”æˆ')) stats[n].total++;
                Object.values(item.votes || {}).forEach(v => { stats[n].logic += Number(v.logic); stats[n].utility += Number(v.utility); stats[n].innovation += Number(v.innovation); stats[n].vCount++; });
            });
            const sorted = Object.keys(stats).sort((a,b) => {
                const p = (n) => (stats[n].vCount > 0 ? (stats[n].logic + stats[n].utility + stats[n].innovation) / (stats[n].vCount * 3) : 0) + (stats[n].total * 0.2);
                return p(b) - p(a);
            });
            document.getElementById('summaryTableBody').innerHTML = sorted.map((name, idx) => {
                const s = stats[name];
                const totalPower = ((s.vCount > 0 ? (s.logic + s.utility + s.innovation) / (s.vCount * 3) : 0) + (s.total * 0.2)).toFixed(1);
                const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : 'ğŸ‘¤';
                return `<tr class="border-b border-slate-50"><td class="px-6 py-10 md:px-10 font-black text-3xl"><span class="mr-6 text-4xl">${medal}</span>@${name}</td><td class="text-center text-purple-500 font-black text-3xl">+${(s.total * 0.2).toFixed(1)}</td><td class="text-center text-slate-400 font-mono text-3xl">${s.vCount}</td><td class="text-right px-6 md:px-12"><span class="achievement-score">${totalPower}</span></td></tr>`;
            }).join('');
        }

        document.getElementById('aiForm').onsubmit = async (e) => {
            e.preventDefault();
            await cloudAction({ action: 'create', id: Date.now().toString(), name: document.getElementById('name').value.trim(), topic: document.getElementById('topic').value.trim(), link: '', startDate: document.getElementById('startDate').value, deadline: document.getElementById('deadline').value, status: 'ğŸš€ æ­£åœ¨èµ·é£›' });
            e.target.reset();
        };

        async function updateProjectLink(id) {
            const item = globalData.find(p => p.id.toString() === id.toString());
            const newLink = prompt("ğŸ”— è«‹è²¼ä¸Šæˆæœç¶²å€:", item?.link || '');
            if (newLink !== null) await cloudAction({ action: 'updateLink', id: id.toString(), link: newLink.trim() });
        }

        async function toggleStatus(id) {
            const item = globalData.find(p => p.id.toString() === id.toString());
            const states = ['ğŸš€ æ­£åœ¨èµ·é£›', 'ğŸ” å¯¦é©—å®¤èª¿æ ¡ä¸­', 'âœ¨ åœ“æ»¿é”æˆç›®æ¨™'];
            let curIdx = states.findIndex(s => (item.status || "").includes(s.slice(2)));
            await cloudAction({ action: 'updateStatus', id: id.toString(), status: states[(curIdx + 1) % 3] });
        }

        async function submitMultiVote() {
            const voter = document.getElementById('voterName').value.trim();
            if (!voter || Object.values(selectedScores).some(v => v === 0)) return showToast("è«‹å®Œæˆè©•åˆ†ï¼");
            const item = globalData.find(p => p.id.toString() === currentRatingProjectId.toString());
            if (item.name === voter) return showToast("ä¸èƒ½æŠ•çµ¦è‡ªå·±ï¼");
            const nVotes = { ...(item.votes || {}) };
            nVotes[voter] = { ...selectedScores, time: new Date().toLocaleString() };
            await cloudAction({ action: 'updateVote', id: currentRatingProjectId.toString(), votes: nVotes });
            closeRatingModal();
        }

        async function deleteProject(id) { if (confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) await cloudAction({ action: 'delete', id: id.toString() }); }
        
        async function toggleAdminView() {
            if (!isAdminView) {
                const pass = prompt("ğŸ” ç®¡ç†å“¡å¯†ç¢¼:");
                if (!pass) return;
                showLoading(true);
                const res = await fetch(`${GAS_URL}?action=verifyAdmin&password=${encodeURIComponent(pass)}`);
                const result = await res.json();
                if (!result.success) { showToast("âŒ å¯†ç¢¼éŒ¯èª¤"); showLoading(false); return; }
            }
            isAdminView = !isAdminView;
            document.getElementById('adminBtn').classList.toggle('bg-purple-600', isAdminView);
            document.getElementById('adminBtn').classList.toggle('text-white', isAdminView);
            updateUI(); showLoading(false);
        }

        function showLoading(s) { document.getElementById('loading').style.display = s ? 'flex' : 'none'; }
        function showToast(m) { const t = document.getElementById('toast'); t.textContent = m; t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 3000); }
        function getStatusClass(s) {
            const t = (s || "").toString();
            if (t.includes('é”æˆ')) return 'bg-emerald-500 text-white border-emerald-700';
            if (t.includes('èª¿æ ¡')) return 'bg-yellow-400 text-purple-900 border-yellow-600';
            return 'bg-purple-600 text-white border-purple-800';
        }
        function formatDate(d) { if (!d) return ''; const date = new Date(d); return `${date.getMonth()+1}/${date.getDate()}`; }
        function openRatingModal(id, title) {
            currentRatingProjectId = id; selectedScores = { logic: 0, utility: 0, innovation: 0 };
            document.getElementById('ratingProjectName').textContent = title;
            document.querySelectorAll('.score-display').forEach(d => d.textContent = '0');
            document.querySelectorAll('.star-row i').forEach(s => s.classList.replace('fas','far'));
            document.getElementById('ratingModal').classList.remove('hidden');
        }
        function closeRatingModal() { document.getElementById('ratingModal').classList.add('hidden'); }
        function setupStars() {
            document.querySelectorAll('.rating-row').forEach(row => {
                const cat = row.dataset.category;
                row.querySelectorAll('.star-row i').forEach(s => {
                    s.onmouseover = () => highlightStars(row, s.dataset.val);
                    s.onclick = () => { selectedScores[cat] = parseInt(s.dataset.val); row.querySelector('.score-display').textContent = selectedScores[cat]; highlightStars(row, selectedScores[cat]); };
                });
                row.onmouseleave = () => highlightStars(row, selectedScores[cat]);
            });
        }
        function highlightStars(row, val) {
            row.querySelectorAll('.star-row i').forEach(s => {
                if (s.dataset.val <= val) { s.classList.replace('far', 'fas'); s.classList.add('star-rating-active'); }
                else { s.classList.replace('fas', 'far'); s.classList.remove('star-rating-active'); }
            });
        }
    </script>
</body>
</html>
